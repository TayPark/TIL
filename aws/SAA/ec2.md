# EC2

- `EC2(Elastic Compute Cloud)`
  - 가상 서버를 제공하는 서비스
  - 실제 물리 서버와 똑같은 형태의 서비스를 제공하며 Linux나 Windows 같은 기본 운영체제가 설치되어있음
  - SSH로 원격 연결 가능(퍼블릭 IP가 있는 경우 직접 연결 가능)
  - 기본 동작으로는 시작, 중지, 종료, 재부팅이 있음
  - 중지가 가능한 디스크 기반 인스턴스의 **EBS 인스턴스**와 임시 스토리지를 제공하여 중지가 불가능한 **Instance Store 인스턴스**가 있음
    - 두 타입 모두 재부팅이 가능하나 중지는 EBS 기반 EC2만 가능
  - 인스턴스 유형으로는 범용, 컴퓨팅 최적화, 메모리 최적화, 스토리지 최적화 등이 있음
  - EC2 상태
    - Pending: 인스턴스가 구동하기 위해 준비중인 상태. 요금 미청구
    - Running: 인스턴스를 실행하고 사용할 준비가 된 상태. 요금 청구
    - Stopping: 인스턴스가 중지 모드로 전환되려는 상태. 요금 미청구
    - Shutting-down: 인스턴스가 종료할 준비중인 상태. 요금 미청구
    - Terminated: 인스턴스가 종료된 상태. 요금 미청구
  - EC2 구매 옵션
    - 온디맨드: 필요할 때 바로 생성하여 사용하는 방식으로, 시간 단위로 과금이 이루어짐
    - 스팟: 경매 방식의 요금이 부여되는 인스턴스. 최초 생성시 기준 가격이 화면에 나타나며 화면의 가격보다 높은 가격을 제시하면 계속 사용이 가능함. 만약 다른 사용자가 더 높은 가격을 입찰했다면 인스턴스가 종료됨. 불시에 중단되어도 상관없거나 테스트용으로 적합
    - 예약: 1년 혹은 3년 단위로 예약하여 사용하는 인스턴스로, 대폭 할인된 요금 제공. 사용하지 않더라도 요금이 부과됨.
  - `AMI(Amazon Machine Image)`
    - 인스턴스를 시작하는데 필요한 정보를 제공하는 이미지
    - AMI를 지정하여 인스턴스를 생성
    - EBS지원 AMI와 인스턴스 스토어지원 AMI로 나뉨
      - EBS 지원 AMI는 EBS 스냅샷에서 루트 디바이스 스토리지가 생성되며, 인스턴스 스토어 지원 AMI는 S3에 저장된 템플릿에서 생성된 스토어 볼륨 사용
    - AMI와 연결된 스냅샷은 지울 수 없음
    - 다른 리전으로 복사가 가능하며 권한을 부여한다면 다른 계정과도 공유 가능
    - AWS Marketplace에서 다른 사람이 만들어둔 AMI 공유 가능
  - `Elastic IP(EIP)`
    - EC2에 설정되는 퍼블릭 IP
      - EC2가 기본적으로 갖는 퍼블릭 IP와 프라이빗 IP와 구분해야 함 
    - EIP를 사용하면 중지되었다가 다시 시작하더라도 고정된 퍼블릭 IP를 사용하게 할 수 있음
    - EIP는 계정 내 **리전당 최대 5개까지 보유 가능**하며, 그 이상 필요시 AWS에 요청해야 함
    - **프리티어의 경우, 사용 중이 아닐 때 요금이 부과**
  - Key pair
    - EC2의 SSH 접속시 keypair 이름의 퍼블릭 키 암호화 기법을 사용하여 접속
    - 분실시 접속 불가
    - 접속시 OS별로 접속 name이 다름(ubuntu, ec2-user, hadoop 등)
  - Batch Group
    - 클러스터: 인스턴스를 AZ 내에서 근접하게 배치. 결합된 노드간 낮은 지연 시간의 네트워크 달성
    - 파티션: 인스턴스가 담긴 그룹을 논리 세그먼트로 나누어 파티션에 배치하는 방식. 최대 7개의 파티션을 가질 수 있으며, 각 파티션은 자체 랙 세트를 보유하고 자체 네트워크와 전원 보유
    - 분산: 인스턴스 개체 하나가 자체 랙에 분산 배치. AZ당 최대 7개의 인스턴스 배치 가능
  - `EBS(Elastic Block Storage)`
    - 블록 형태의 스토리지
    - 애플리케이션의 기본 스토리지 또는 시스템 드라이브로 사용
    - 인스턴스 생성시 루트 디바이스 볼륨이 생성되며 **사용중에는 unmount 불가능**
    - 인스턴스는 여러 볼륨을 마운트 할 수 있고, 추가 볼륨에 대해서는 사용 중이라도 마운트/언마운트 가능
    - 볼륨은 여러 인스턴스에 마운트 할 수 없음
    - EBS를 특정 AZ에서 생성하더라도 다른 AZ의 인스턴스에 즉시 붙일 수 있음
    - 사용중인 EBS더라도 볼륨 유형과 사이즈를 변경 가능(사이즈 축소는 불가)
    - **EBS 볼륨 유형**
      - 범용 SSD(gp2): 시스템 부트. 대부분의 워크로드
      - 프로비저닝된 IOPS SSD(io1): 지속적인 IOPS 성능이나 16,000 IOPS 이상의 볼륨당 처리량을 필요로 하는 경우 적합(DB 등)
      - 처리량 최적화된 HDD(st1): 시스템 부트 사용 불가능. IOPS가 아닌 처리량을 기준으로 하며, 자주 액세스하는 워크로드에 적합한 저비용 HDD 볼륨. 빅데이터나 DW에 사용
      - Cold HDD(sc1): 시스템 부트 사용 불가능. 자주 액세스하지 않는 대용량 데이터 처리에 적합. 스토리지 비용이 최대로 낮아야 할 경우 사용
  - 스냅샷과 EBS
    - 스냅샷을 이용하여 EBS 볼륨의 데이터를 S3에 저장할 수 있음.
      - 증분석 백업이기 때문에 스냅샷은 하나이며 마지막 스냅샷 이후 변경된 블록만 추가적으로 저장
    - 각 스냅샷에는 스냅샷을 만든 시점의 데이터를 새 EBS 볼륨에 복원하는 데 필요한 정보가 들어있음
    - EBS의 스냅샷은 S3에 저장되며 이를 통해 볼륨 복구 가능
    - 암호화된 볼륨의 스냅샷은 자동으로 암호화됨
    - 암호화된 스냅샷에서 생성되는 볼륨은 자동으로 암호화
    - 암호화되지 않은 EBS에서 암호화된 스냅샷은 생성할 수 없음
  - EBS 암호화
    - 부팅 및 데이터 볼륨 암호화 가능
    - 다음 유형의 데이터가 암호화됨
      - 볼륨 내부 데이터
      - 볼륨과 인스턴스 사이에서 이동하는 데이터
      - 볼륨에서 생성된 모든 스냅샷
      - 스냅샷에서 생성된 모든 볼륨(스냅샷이 암호화되면 해당 스냅샷에서 생성된 볼륨은 자동 암호화)
      - AES-256 사용
  - RAID 구성
    - RAID 0: I/O 성능이 내결함성보다 중요한 경우
    - RAID 1: 내결함성이 I/O 성능보다 중요한 경우