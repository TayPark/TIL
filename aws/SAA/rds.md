# RDS(Relcational Database Service)

- RDS
  - 관계형 데이터베이스 서비스(SaaS)
  - MySQL, MariaDB, PostgreSQL, Oracle, MSSQL, Aurora
  - DB 인스턴스에 대한 Shell 지원 불가 및 OS 제어 불가
  - 백업, 소프트웨어 패치, 장애 감지 및 복구를 AWS가 관리
  - Storage 용량에 대해 오토 스케일링 지원
- DB Instance
  - 인스턴스: RDS의 기본 구성 요소, 클라우드에서 실행하는 격리된 데이터베이스 환경을 말함
  - EC2처럼 다양한 클래스로 구성
  - RDS도 클라우드에서 실행되기 때문에 하나의 AZ에 격리되어 인스턴스로 실행
- DB Instance Storage
  - 데이터베이스 유지를 위해 EBS를 사용하며 필요한 스토리지 용량에 맞춰 자동으로 데이터를 여러 EBS 볼륨에 나누어 저장
  - 스토리지 유형
    - 범용 SSD: 말 그대로 범용적 목적의 워크로드
    - 프로비저닝 IOPS: 빠르고 일관적인 I/O 성능, 낮은 지연시간 필요시 사용
    - 마그네틱: 접속 빈도가 적은 워크로드
- `Multi-AZ`
  - RDS는 Multi-AZ를 통해 고가용성 제공
    - 다수의 AZ에 DB 인스턴스를 두어 하나의 AZ가 파괴되어 서비스가 불가능할 때를 대비
    - 기본 인스턴스가 수행해야 할 작업(백업, 스냅샷)을 대신 수행하여 기본 인스턴스의 부담을 줄임
    - 기본 인스턴스에서 스냅샷을 캡처한 후 다른 AZ에 복원하여 "동기식으로" 복제본 생성
      - Active-Standby 구조
      - **"예비" 복제본이기 때문에 읽기 및 쓰기 작업을 수행할 수 없음**
  - Multi-AZ를 사용하는 경우, 단일 AZ 배포에 비해 쓰기 및 저장 지연이 길어질 수 있음(데이터 동기화 때문)
  - Multi-AZ를 활성화한 상태에서 DB 인스턴스에 문제가 발생하면 자동으로 다른 AZ의 예비 복제본이 기본 인스턴스로 전환
    - 전환에 사용되는 시간은 1-2분
  - 전환되는 상황
    - AZ 중단
    - 기본 DB 인스턴스 오류
    - DB 인스턴스 서버 유형 변경
    - 기본 DB 인스턴스 OS에서 소프트웨어 패치 실시
    - Failover 실시
- `Read Replica`
  - 읽기 전용 복제본
  - 읽기 작업을 담당하여 마스터 DB의 부하를 줄이는 목적
  - 기본 DB 인스턴스의 스냅샷을 캡처하여 Read Replica 를 생성하며, 데이터를 **"비동기" 복제** 방식을 통해 업데이트
  - MySQL, Oracle, PostgreSQL, MariaDB에서 사용 가능
  - 다른 리전에도 사용 가능
  - 리전당 최대 5개까지 가능
  - Read Replica 또한 독립된 인스턴스로 승격 가능
- 자동 백업(Automated Backup)
  - RDS의 자동백업 서비스. DB 인스턴스 자체를 백업
  - 매일매일 백업이 이루어지며 기본 보존 기간은 CLI로 생성시 1일, 콘솔로 생성시 7일이며 1~35일까지 가능
  - 특정 시점을 지정하여 복원이 가능하며, 복원 기간내로부터 최근 5분까지 특정 시점을 지정하여 복원 가능
  - 사용자가 지정한 백업 시간에 자동적으로 백업되며, 백업 중에는 스토리지 I/O 가 일시적으로 중단될 수 있음(Multi-AZ 사용시 Standby에서 백업 실시)
- 스냅샷(Snapshot)
  - DB 인스턴스의 특정 시점을 스냅샷으로 생성하는 것
  - 자동 및 수동 생성 가능
  - 자동 백업과 달리 **스냅 생성 시점으로만 복원 가능**
  - 스냅샷으로 복원시 DB 인스턴스를 복원하지 않고 **개별 DB 인스턴스가 생성**
  - 스냅샷 복사, 공유, 마이그레이션 가능
  - 스냅샷 생성 중에는 스토리지 I/O 가 일시적으로 중단될 수 있음(Multi-AZ 사용시 Standby에서 백업 실시)
- Enhanced Monitoring
  - RDS 지표를 실시간으로 모니터링
  - CloudWatch Logs 에 30일간 저장
  - 일반 모니터링과 차이점은 인스턴스 내 에이전트를 통해 지표를 수집(CloudWatch는 하이퍼바이저에서 수집)
  - 최대 1초 단위까지 수집
- Amazon Aurora
  - MySQL, PostgreSQL과 호환가능한 AWS의 자체 설계 RDBMS
  - 각 AZ마다 2개의 데이터 복사본을 자동으로 유지하며, 에러를 스스로 찾아내고 복구
  - Read Replica는 **최대 15개까지 가능**하며, **백업과 스냅샷이 퍼포먼스에 영향을 주지 않음**
