# LXC vs Docker: Why Docker is Better

LXC(LinuX Containers)는 OS 레벨의 가상화 기술이며 여러 호스트 머신에 격리된 VE(Virtual Environment)를 생성하고 실행할 수 있게 한다. 이들은 **컨테이너** 혹은 **격리 레벨**이라 한다.

이 컨테이너들은 특정 애플리케이션을 실행하는 샌드박스로 사용되거나 새로운 호스트를 에뮬레이팅하는데 사용될 수 있다. LXC는 리눅스의 2.6.24 버전부터 도입된 `cgroup`(control-group. CPU 시간, 시스템 메모리, 네트워크 대역폭과 같은 자원이나 이러한 자원의 조합을 시스템에서 실행 중인 사용자 정의 작업 그룹 (프로세스. 혹은 `namespace`) 간에 할당이 가능하다.)을 사용한다. 

도커는 2013년 사이드 프로젝트로 시작했다. LXC의 기능을 확장한 것이었고, 이 때의 도커는 격리된 경량 가상화 프로세스를 고수준 API를 제공하기 위한 프로젝트였다. 도커는 Go언어로 개발되어 LXC, cgroup, 그리고 리눅스 커널을 좀 더 효율적이게 만들었다.

LXC를 베이스로 하였기에 도커는 가상화 시점에서 OS를 포함하지 않는다. 그러므로 도커는 이식성이 좋은 컨테이너 엔진처럼 이용할 수 있고 애플리케이션과 종속성들을 컨테이너로 패키징하여 어떠한 리눅스 서버에서도 구동이 가능하도록 만들었다. 

## VE vs. VM

VE와 VM의 가장 큰 차이점은 VE는 VM에서 필요한, 프리로드(preload) 되어야할 에뮬레이팅 소프트웨어(주로 OS)가 필요하지 않다는 것이다. VE는 애플리케이션(또는 OS)이 프로세스로 생성되므로 사소한 초기화를 제외하고는 사전작업이 없다. 하드웨어 에뮬레이션이 없다는 것은 애플리케이션 구동에 필요한 것들만 패키징하므로 좋은 성능을 지닐 수 있다는 것이다.

하지만 VM이 멸종되지 않은 이유는 무엇일까? 이는 VE가 신속하게 배포할 수 있는 시스템으로 깔끔하게 패키징 할 수 없었다는 점이다. 또한 GUI 관리 콘솔 등으로 쉽게 관리할 수 없고 IaaS 셋업이나 라이브 마이그레이션 등 VM에서 제공하는 기능들을 아직까지는 제공하지 않기 때문이다.

## 하는 일

LXC는 애플리케이션 뿐만 아니라 OS전체를 격리할 수 있다. 경량 프로세스에 컨테이너를 생성하는 일을 하지만 아니라 이 생성 자체가 빠르게 부팅되고 적은 메모리를 사용한다. 
- libvirt: 컨테이너의 사용을 LXC 드라이버(lxc:///)로 사용할 수 있게 한다.
- 간단하게 불리는 **LXC**는 libvirt와 호환되지 않지만 더 유연한 도구를 제공한다. 

반면에 도커는

- 이식성이 높은 배포
- 버저닝
- 컴포넌트 재사용
- 공유 라이브러리

의 이점을 LXC 위에 쌓아서 고수준의 도구로 제공한다.

## Docker FAQ: LXC vs. Docker

`Docker`는 `LXC`의 대체제가 아니다. LXC는 리눅스 커널의 cgroup 및 namespace를 이용하여 프로세스를 격리하고 리소스 할당을 관리하는 것을 말한다. LXC는 리눅스 커널의 기능을 저수준으로 제공하지만 **Docker는 LXC의 탑 레이어에서 도구들을 이용하여 강력한 기능들을 고수준으로 제공한다.**(일종의 wrapper이다.)

## VMWare: Why use containers vs. VMs?

**가상 머신은 제한된 워크로드 이식성에 대한 인프라 문제를 해결**한 것이고 **컨테이너는 애플리케이션 이식성을 높이고 리소스 사용성의 향상**을 꽤한 것이다.

컨테이너는 호스트 OS를 공유하고 오직 애플리케이션 자체의 디펜던시만을 가진다. VM과 다르게 컨테이너는 일반적으로 MB정도의(VM은 GB) 사이즈를 가진다. 싱글 서버에서 운영되는 컨테이너들은 호스트 OS를 공유하므로 필요에 따라 변하는 프로세스 환경에서 효율적이다.

### VM Pros and Cons

Pros
- 가상화 역사 수십년간 쌓인 운영, 보안 노하우가 있다.
- 하나의 인프라로부터 다수의 OS 위에서 다수의 애플리케이션을 구동할 수 있다.
  - **즉, 애플리케이션에 특성화된 OS를 사용할 수 있다.**
- **전체 OS 리소스를 포함한 컴퓨터 환경 자체를 에뮬레이팅 할 수 있다.**
- **온프레미스와 클라우드 플랫폼 사이에서 이식이 쉽다.**
- VM을 제공하는 성숙한 벤더사들이 있다.

Cons
- VM 이미지가 과도하게 커서 실행, 백업, 마이그레이션이 오래 걸린다.
- OS를 포함한 전체 서버를 캡슐화 하므로 하나의 서버에서는 컨테이너보다 VM을 적게 수용한다.

### Container Pros and Cons

Pros
- VM보다 경량이다. 그러므로 더 많은 컨테이너를 띄울 수 있다.
- **배포를 위한 리소스가 적게 필요하며 구동이 빠르다.**

Cons
- **모든 컨테이너들은 같은 OS위에서 구동되어야 한다 - OS나 버전을 컨테이너에 맞출 수 없다.**
- 컨테이너는 OS를 공유하므로 VM에 비해 안전하지 않다.
- 나름 신기술이므로 VM에 비해 역사가 짧고 커뮤니티가 자라고 있다.

## 참고자료

https://www.upguard.com/blog/docker-vs-lxc

https://access.redhat.com/documentation/ko-kr/red_hat_enterprise_linux/6/html/resource_management_guide/ch01

https://www.vmware.com/topics/glossary/content/vms-vs-containers

https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools